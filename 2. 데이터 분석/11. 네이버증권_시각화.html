<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„¤ì´ë²„ ì¦ê¶Œ ë°ì´í„° ì‹œê°í™”</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .info-card .value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .chart-container h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.5em;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #e74c3c;
            font-size: 1.2em;
            background: #ffe6e6;
            border-radius: 10px;
            margin: 20px 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .data-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: center;
        }

        .data-table th {
            font-weight: 600;
        }

        .data-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .data-table tbody tr:hover {
            background: #e9ecef;
            transition: background 0.2s;
        }

        .positive {
            color: #e74c3c;
            font-weight: bold;
        }

        .negative {
            color: #3498db;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ˆ ë„¤ì´ë²„ ì¦ê¶Œ ë°ì´í„° ì‹œê°í™”</h1>
        <p class="subtitle">SKí•˜ì´ë‹‰ìŠ¤ (000660) ì¼ë´‰ ì°¨íŠ¸</p>
        
        <div id="loading" class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="content" style="display: none;">
            <div class="info-panel" id="infoPanel"></div>
            
            <div class="chart-container">
                <h2>ğŸ“Š ê°€ê²© ì¶”ì´ ì°¨íŠ¸</h2>
                <canvas id="priceChart"></canvas>
            </div>
            
            <div class="chart-container">
                <h2>ğŸ“‰ ê±°ë˜ëŸ‰ ì°¨íŠ¸</h2>
                <canvas id="volumeChart"></canvas>
            </div>
            
            <table class="data-table" id="dataTable">
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>ì‹œê°€</th>
                        <th>ê³ ê°€</th>
                        <th>ì €ê°€</th>
                        <th>ì¢…ê°€</th>
                        <th>ê±°ë˜ëŸ‰</th>
                        <th>ë“±ë½ë¥ </th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let priceChart = null;
        let volumeChart = null;

        // JSON íŒŒì¼ ë¡œë“œ
        async function loadData() {
            try {
                const response = await fetch('ë„¤ì´ë²„ì¦ê¶Œ_ë°ì´í„°.json');
                if (!response.ok) {
                    throw new Error('JSON íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                const data = await response.json();
                processData(data);
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'ì˜¤ë¥˜: ' + error.message;
            }
        }

        // ë°ì´í„° ì²˜ë¦¬ ë° ì‹œê°í™”
        function processData(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            // priceInfos ë°°ì—´ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            let candles = [];
            
            if (data.priceInfos && Array.isArray(data.priceInfos)) {
                candles = data.priceInfos;
            } else {
                console.log('ë°ì´í„° êµ¬ì¡°:', data);
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'ì§€ì›í•˜ì§€ ì•ŠëŠ” ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤. priceInfos ë°°ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }

            if (candles.length === 0) {
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }

            // ë°ì´í„° ì •ë ¬ (ë‚ ì§œìˆœ - localDate ê¸°ì¤€)
            candles.sort((a, b) => {
                const dateA = a.localDate || '';
                const dateB = b.localDate || '';
                return dateA.localeCompare(dateB);
            });

            // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜ (localDate: "20250711" í˜•ì‹ì˜ ë¬¸ìì—´)
            function formatDate(localDate) {
                if (!localDate || localDate.length !== 8) {
                    return localDate;
                }
                const year = localDate.substring(0, 4);
                const month = localDate.substring(4, 6);
                const day = localDate.substring(6, 8);
                return `${year}-${month}-${day}`;
            }

            // ì¼ì¼ ê±°ë˜ëŸ‰ ê³„ì‚° (ëˆ„ì  ê±°ë˜ëŸ‰ì˜ ì°¨ì´)
            function calculateDailyVolumes(candles) {
                const dailyVolumes = [];
                for (let i = 0; i < candles.length; i++) {
                    if (i === 0) {
                        dailyVolumes.push(candles[i].accumulatedTradingVolume || 0);
                    } else {
                        const current = candles[i].accumulatedTradingVolume || 0;
                        const previous = candles[i - 1].accumulatedTradingVolume || 0;
                        dailyVolumes.push(Math.max(0, current - previous));
                    }
                }
                return dailyVolumes;
            }

            // ë°ì´í„° ì¶”ì¶œ
            const labels = candles.map(candle => {
                return formatDate(candle.localDate);
            });

            const openPrices = candles.map(c => c.openPrice || 0);
            const highPrices = candles.map(c => c.highPrice || 0);
            const lowPrices = candles.map(c => c.lowPrice || 0);
            const closePrices = candles.map(c => c.closePrice || 0);
            const volumes = calculateDailyVolumes(candles);

            // í†µê³„ ì •ë³´ ê³„ì‚°
            const latest = candles[candles.length - 1];
            const previous = candles[candles.length - 2] || latest;
            const latestClose = closePrices[closePrices.length - 1];
            const previousClose = closePrices[closePrices.length - 2] || latestClose;
            const change = latestClose - previousClose;
            const changePercent = previousClose !== 0 ? ((change / previousClose) * 100).toFixed(2) : 0;

            const maxPrice = Math.max(...highPrices);
            const minPrice = Math.min(...lowPrices);
            const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;

            // ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
            updateInfoPanel(latestClose, change, changePercent, maxPrice, minPrice, avgVolume);

            // ì°¨íŠ¸ ìƒì„±
            createPriceChart(labels, openPrices, highPrices, lowPrices, closePrices);
            createVolumeChart(labels, volumes);

            // í…Œì´ë¸” ìƒì„±
            createTable(candles, formatDate);
        }

        // ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updateInfoPanel(close, change, changePercent, max, min, avgVol) {
            const panel = document.getElementById('infoPanel');
            panel.innerHTML = `
                <div class="info-card">
                    <h3>í˜„ì¬ê°€</h3>
                    <div class="value">${close.toLocaleString()}ì›</div>
                </div>
                <div class="info-card">
                    <h3>ì „ì¼ ëŒ€ë¹„</h3>
                    <div class="value ${change >= 0 ? 'positive' : 'negative'}">
                        ${change >= 0 ? '+' : ''}${change.toLocaleString()}ì›
                    </div>
                </div>
                <div class="info-card">
                    <h3>ë“±ë½ë¥ </h3>
                    <div class="value ${changePercent >= 0 ? 'positive' : 'negative'}">
                        ${changePercent >= 0 ? '+' : ''}${changePercent}%
                    </div>
                </div>
                <div class="info-card">
                    <h3>ìµœê³ ê°€</h3>
                    <div class="value">${max.toLocaleString()}ì›</div>
                </div>
                <div class="info-card">
                    <h3>ìµœì €ê°€</h3>
                    <div class="value">${min.toLocaleString()}ì›</div>
                </div>
                <div class="info-card">
                    <h3>í‰ê·  ê±°ë˜ëŸ‰</h3>
                    <div class="value">${Math.round(avgVol).toLocaleString()}</div>
                </div>
            `;
        }

        // ê°€ê²© ì°¨íŠ¸ ìƒì„±
        function createPriceChart(labels, open, high, low, close) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }

            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ì‹œê°€',
                            data: open,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'ê³ ê°€',
                            data: high,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'ì €ê°€',
                            data: low,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.1,
                            pointRadius: 0
                        },
                        {
                            label: 'ì¢…ê°€',
                            data: close,
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            tension: 0.1,
                            pointRadius: 0,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString() + 'ì›';
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }

        // ê±°ë˜ëŸ‰ ì°¨íŠ¸ ìƒì„±
        function createVolumeChart(labels, volumes) {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            
            if (volumeChart) {
                volumeChart.destroy();
            }

            volumeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ê±°ë˜ëŸ‰',
                        data: volumes,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'ê±°ë˜ëŸ‰: ' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        // í…Œì´ë¸” ìƒì„±
        function createTable(candles, formatDate) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            candles.forEach((candle, index) => {
                const localDate = candle.localDate || '';
                const open = candle.openPrice || 0;
                const high = candle.highPrice || 0;
                const low = candle.lowPrice || 0;
                const close = candle.closePrice || 0;
                
                // ì¼ì¼ ê±°ë˜ëŸ‰ ê³„ì‚°
                let volume = 0;
                if (index === 0) {
                    volume = candle.accumulatedTradingVolume || 0;
                } else {
                    const current = candle.accumulatedTradingVolume || 0;
                    const previous = candles[index - 1].accumulatedTradingVolume || 0;
                    volume = Math.max(0, current - previous);
                }
                
                const previousClose = index > 0 ? 
                    (candles[index - 1].closePrice || close) : close;
                const change = close - previousClose;
                const changePercent = previousClose !== 0 ? ((change / previousClose) * 100).toFixed(2) : 0;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(localDate)}</td>
                    <td>${open.toLocaleString()}</td>
                    <td>${high.toLocaleString()}</td>
                    <td>${low.toLocaleString()}</td>
                    <td>${close.toLocaleString()}</td>
                    <td>${volume.toLocaleString()}</td>
                    <td class="${change >= 0 ? 'positive' : 'negative'}">
                        ${change >= 0 ? '+' : ''}${changePercent}%
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
